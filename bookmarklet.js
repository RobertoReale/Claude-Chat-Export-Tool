javascript:!function(){function e(e,t){return t.every(t=>e.classList.contains(t))}function t(e){let t=0;for(let n=0;n<e.length;n++){t=(t<<5)-t+e.charCodeAt(n),t&=t}return t.toString()}function n(e,t=null){let n="";const o=['[data-testid="user-message"]',"div.font-user-message",".prose"];for(const t of o){const o=e.querySelector(t);if(o){const e=o.textContent?.trim()||"";e.length>n.length&&(n=e)}}return n||(n=e.textContent?.trim()||""),function(e,t=null){if(!e)return"";if(t){const n=new RegExp(`^${t}\\s*`,"g");e=e.replace(n,"")}return(e=(e=(e=(e=(e=e.replace(/^[A-Z]{1,3}\s+/,"")).replace(/(Edit|Modifica)\s*\d*\s*\/?\s*\d*/gi,"")).replace(/(?<![a-zA-Z])(Share|Copy|Delete|Condividi|Copia|Elimina)(?![a-zA-Z])/gi,"")).replace(/(?<![a-zA-Z0-9])\d+\s*\/\s*\d+(?![a-zA-Z0-9])/g,"")).replace(/(Edit|Modifica)\s*$/gi,"")).replace(/\s+/g," ").trim()}(n,t)}function o(e){if(!e)return null;let t="",n="";const o=['[class*="tabular-nums"]','[class*="time"]','span:contains("s")','div:contains("s")'];for(const n of o){const o=e.querySelector(n);if(o&&o.textContent.match(/\d+s?/)){t=o.textContent.trim();break}}const r=e.querySelector('[class*="overflow-y-auto"]')||e.querySelector('[class*="overflow"]')||e;return r&&(r.querySelectorAll("p").forEach(e=>{const t=e.textContent.trim();t&&!t.match(/^\d+s?$/)&&(n+=t+"\n\n")}),r.querySelectorAll("ol, ul").forEach(e=>{const t=e.querySelectorAll("li");t.forEach((t,o)=>{const r=t.textContent.trim();r&&("OL"===e.tagName?n+=`${o+1}. ${r}\n`:n+=`- ${r}\n`)}),t.length>0&&(n+="\n")})),n.trim()?{content:n.trim(),time:t}:null}function r(e){const t=e.querySelector('annotation[encoding="application/x-tex"]');return t?t.textContent.trim():null}function s(e,t=null,n={parts:[]},o=0){if(t&&t.contains(e))return n;if(e.classList&&e.classList.contains("katex")){const t=r(e);if(t){const o=e.classList.contains("katex-display")||e.parentElement?.classList.contains("katex-display");n.parts.push({type:"math",content:t,display:o})}return n}if(e.classList&&(e.classList.contains("katex-html")||e.classList.contains("katex-mathml")))return n;const a=e.tagName?.toLowerCase();if("strong"===a||"b"===a){if(function(e){return e.querySelector&&null!==e.querySelector(".katex")}(e)){for(const a of e.children)if(a.classList&&a.classList.contains("katex")){const e=r(a);e&&n.parts.push({type:"bold_math",content:e})}else s(a,t,n,o);for(const t of e.childNodes)if(t.nodeType===Node.TEXT_NODE){const e=t.textContent.trim();e&&n.parts.push({type:"bold",content:e})}return n}return n.parts.push({type:"bold",content:e.textContent.trim()}),n}if("em"===a||"i"===a)return n.parts.push({type:"italic",content:e.textContent.trim()}),n;if("br"===a)return n.parts.push({type:"break"}),n;if("p"===a||"div"===a){const r=n.parts[n.parts.length-1];r&&"paragraph"!==r.type&&n.parts.push({type:"paragraph"});for(const r of e.childNodes)if(r.nodeType===Node.TEXT_NODE){const e=r.textContent.trim();if(e){const t=n.parts[n.parts.length-1];t&&"text"===t.type?t.content+=" "+e:n.parts.push({type:"text",content:e})}}else r.nodeType===Node.ELEMENT_NODE&&s(r,t,n,o);return n.parts.push({type:"paragraph"}),n}if("ul"===a||"ol"===a){const r="ol"===a;return Array.from(e.children).filter(e=>"li"===e.tagName.toLowerCase()).forEach((e,a)=>{n.parts.push({type:"listitem",ordered:r,depth:o,index:a+1});for(const r of e.childNodes)if(r.nodeType===Node.TEXT_NODE){const e=r.textContent.trim();e&&n.parts.push({type:"text",content:e})}else r.nodeType===Node.ELEMENT_NODE&&s(r,t,n,o+1);n.parts.push({type:"break"})}),n}if("code"===a&&(!e.parentElement||"PRE"!==e.parentElement.tagName))return n.parts.push({type:"code",content:e.textContent}),n;if("pre"===a){const t=e.querySelector("code");return n.parts.push({type:"codeblock",content:t?t.textContent:e.textContent,language:t?.className?.match(/language-(\w+)/)?.[1]||""}),n}if(a&&a.match(/^h[1-6]$/))return n.parts.push({type:"heading",level:parseInt(a[1]),content:e.textContent}),n;for(const r of e.childNodes)if(r.nodeType===Node.TEXT_NODE){const e=r.textContent.trim();if(e){const t=n.parts[n.parts.length-1];t&&"text"===t.type?t.content+=" "+e:n.parts.push({type:"text",content:e})}}else r.nodeType===Node.ELEMENT_NODE&&s(r,t,n,o);return n}function a(e,t){console.log("Extracting Claude response...");const n=e.querySelector("div.font-claude-message")||e.querySelector('[class*="prose"]')||e;if(!n)return console.warn("No response area found"),"";const{parts:o}=s(n,t);console.log(`Extracted ${o.length} content parts`);const r=function(e){let t="";for(let n=0;n<e.length;n++){const o=e[n];switch(o.type){case"text":t+=o.content;break;case"math":o.display?t+=`\n\n$$${o.content}$$\n\n`:t+=`$${o.content}$`;break;case"bold_math":t+=`**$${o.content}$**`;break;case"listitem":t.endsWith("\n")||(t+="\n");const e="  ".repeat(o.depth);o.ordered?t+=`${e}${o.index}. `:t+=`${e}- `;break;case"paragraph":t.endsWith("\n\n")||(t+="\n\n");break;case"break":t.endsWith("\n")||(t+="\n");break;case"code":t+=`\`${o.content}\``;break;case"codeblock":t+=`\n\`\`\`${o.language}\n${o.content}\n\`\`\`\n`;break;case"bold":t+=`**${o.content}**`;break;case"italic":t+=`*${o.content}*`;break;case"heading":t+=`\n${"#".repeat(o.level)} ${o.content}\n\n`}}return t=t.replace(/\n{3,}/g,"\n\n").trim(),t}(o);return console.log("Generated markdown:",r.substring(0,200)+"..."),r}console.log("🚀 Starting Complete Claude Chat Export...");try{const r=function(){const e=['button[data-testid="chat-menu-trigger"] div.truncate',"header div.truncate","div.truncate.tracking-tight","button div.truncate"];for(const t of e){const e=document.querySelector(t);if(e){const t=e.textContent?.trim();if(t&&t.length>0&&!t.match(/^[A-Z]{1,3}$/))return t}}return"Claude Chat Export"}();console.log(`📄 Chat title: ${r}`);const s=function(){const r=[],s=new Set,c=document.querySelectorAll("div"),l=function(){const e=document.querySelectorAll('div[class*="rounded-full"][class*="font-bold"]');for(const t of e){const e=t.textContent?.trim();if(e&&e.match(/^[A-Z]{1,3}$/))return e}return null}();console.log(`📝 Analyzing ${c.length} elements...`),l&&console.log(`👤 Found user initials: ${l}`);for(const i of c){let c=null;if(e(i,["group","relative","inline-flex","bg-bg-300"])||e(i,["group","relative","inline-flex"])&&i.classList.contains("bg-bg-300")){const e=n(i,l);e&&e.length>0&&(c={type:"user",content:e,element:i,contentHash:t(e)},console.log("👤 Found user message:",e.substring(0,50)+"..."))}else if(e(i,["group","relative","-tracking-[0.015em]"])||e(i,["group","relative"])&&i.classList.contains("-tracking-[0.015em]")){const e=i.querySelector('[class*="rounded-lg"][class*="border"]');let n=null;e&&e.querySelector('[class*="overflow"]')&&(n=o(e),console.log("🧠 Found reasoning:",n?.content.substring(0,50)+"..."));const r=a(i,e);(n||r)&&(c={type:"claude",reasoning:n,response:r,element:i,contentHash:t((n?.content||"")+(r||""))},console.log("🤖 Found Claude message"+(n?" (with reasoning)":"")))}c&&!s.has(c.contentHash)&&(s.add(c.contentHash),r.push(c))}return console.log(`✅ Extracted ${r.length} messages total`),0===r.length?(console.warn("⚠️ No messages found"),null):(r.sort((e,t)=>e.element.compareDocumentPosition(t.element)&Node.DOCUMENT_POSITION_FOLLOWING?-1:1),r)}();if(!s||0===s.length)return void alert("❌ No conversation found. Make sure you're on a Claude chat page with messages.");const c=function(e,t){let n=`# ${t}\n\n`;return n+=`*Exported on: ${(new Date).toLocaleString()}*\n\n`,n+=`*Total messages: ${e.length}*\n\n`,n+="---\n\n",e.forEach((t,o)=>{"user"===t.type?n+=`## 👤 User\n\n${t.content}\n\n`:"claude"===t.type&&(n+="## 🤖 Claude\n\n",t.reasoning&&t.reasoning.content&&(n+="<details>\n<summary>🧠 Reasoning",t.reasoning.time&&(n+=` (${t.reasoning.time})`),n+=`</summary>\n\n${t.reasoning.content}\n\n</details>\n\n`),t.response&&(n+=`${t.response}\n\n`)),o<e.length-1&&(n+="---\n\n")}),n}(s,r);console.log("📄 Generated markdown:",c.length,"characters"),console.log("📄 Markdown preview:\n",c.substring(0,500)+"..."),function(e,t){const n=new Blob([e],{type:"text/markdown;charset=utf-8"}),o=URL.createObjectURL(n),r=document.createElement("a");r.href=o;const s=t.replace(/[^a-zA-Z0-9\s\-_]/g,"").replace(/\s+/g,"-").toLowerCase().substring(0,50);r.download=`${s}-${(new Date).toISOString().slice(0,19).replace(/:/g,"-")}.md`,document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(o)}(c,r),console.log("🎉 Export complete!"),alert(`✅ Successfully exported ${s.length} messages!\nCheck your downloads folder.`)}catch(e){console.error("❌ Export error:",e),alert("❌ Export failed. Check the console for details.")}}();
