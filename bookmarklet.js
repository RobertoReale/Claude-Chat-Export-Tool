javascript:!function(){function e(e,t){return t.every(t=>e.classList.contains(t))}function t(e){let t=0;for(let n=0;n<e.length;n++){t=(t<<5)-t+e.charCodeAt(n),t&=t}return t.toString()}function n(e,t=null){let n="";const o=['[data-testid="user-message"]',"div.font-user-message",".prose"];for(const t of o){const o=e.querySelector(t);if(o){const e=o.textContent?.trim()||"";e.length>n.length&&(n=e)}}return(!n||n.length<10)&&(n=e.textContent?.trim()||""),function(e,t=null){if(!e)return"";if(t){const n=new RegExp(`^${t}\\s*`,"g");e=e.replace(n,"")}return(e=(e=(e=e.replace(/^[A-Z]{1,3}\s+/,"")).replace(/\b(Share|Copy|Edit|Delete|Modifica|Condividi|Copia|Modifica|Elimina)\b/g,"")).replace(/\d+\/\d+/g,"")).replace(/\s+/g," ").trim()}(n,t)}function o(e){if(!e)return null;let t="",n="";const o=['[class*="tabular-nums"]','[class*="time"]','span:contains("s")','div:contains("s")'];for(const n of o){const o=e.querySelector(n);if(o&&o.textContent.match(/\d+s?/)){t=o.textContent.trim();break}}const s=e.querySelector('[class*="overflow-y-auto"]')||e.querySelector('[class*="overflow"]')||e;return s&&(s.querySelectorAll("p").forEach(e=>{const t=e.textContent.trim();t&&!t.match(/^\d+s?$/)&&(n+=t+"\n\n")}),s.querySelectorAll("ol, ul").forEach(e=>{const t=e.querySelectorAll("li");t.forEach((t,o)=>{const s=t.textContent.trim();s&&("OL"===e.tagName?n+=`${o+1}. ${s}\n`:n+=`- ${s}\n`)}),t.length>0&&(n+="\n")})),n.trim()?{content:n.trim(),time:t}:null}function s(e,t=null,n={parts:[]}){if(t&&t.contains(e))return n;if(e.classList&&(e.classList.contains("katex")||Array.from(e.classList).some(e=>e.includes("math")))){let t=e.getAttribute("data-latex")||e.querySelector(".katex-mathml annotation")?.textContent||e.textContent;if(t){const o=e.classList.contains("katex-display")||e.parentElement?.classList.contains("katex-display");n.parts.push({type:"math",content:t,display:o})}return n}for(const o of e.childNodes)if(o.nodeType===Node.TEXT_NODE){const e=o.textContent;if(e&&e.trim()){const t=n.parts[n.parts.length-1];t&&"text"===t.type?t.content+=e:n.parts.push({type:"text",content:e})}}else if(o.nodeType===Node.ELEMENT_NODE){const e=o.tagName.toLowerCase();if("br"===e)n.parts.push({type:"break"});else if("p"===e||"div"===e){const e=n.parts[n.parts.length-1];e&&"break"!==e.type&&"paragraph"!==e.type&&n.parts.push({type:"paragraph"}),s(o,t,n),n.parts.push({type:"paragraph"})}else if("code"===e&&"PRE"!==o.parentElement.tagName)n.parts.push({type:"code",content:o.textContent});else if("pre"===e){const e=o.querySelector("code");n.parts.push({type:"codeblock",content:e?e.textContent:o.textContent,language:e?.className?.match(/language-(\w+)/)?.[1]||""})}else"strong"===e||"b"===e?n.parts.push({type:"bold",content:o.textContent}):"em"===e||"i"===e?n.parts.push({type:"italic",content:o.textContent}):e.match(/^h[1-6]$/)?n.parts.push({type:"heading",level:parseInt(e[1]),content:o.textContent}):s(o,t,n)}return n}function r(e,t){console.log("Extracting Claude response...");const n=e.querySelector("div.font-claude-message")||e.querySelector('[class*="prose"]')||e;if(!n)return console.warn("No response area found"),"";const{parts:o}=s(n,t);console.log(`Extracted ${o.length} content parts`);const r=function(e){let t="";for(let n=0;n<e.length;n++){const o=e[n];switch(o.type){case"text":t+=o.content;break;case"math":o.display?t+=`\n\n$$${o.content}$$\n\n`:t+=`$${o.content}$`;break;case"paragraph":t.endsWith("\n\n")||(t+="\n\n");break;case"break":t+="\n";break;case"code":t+=`\`${o.content}\``;break;case"codeblock":t+=`\n\`\`\`${o.language}\n${o.content}\n\`\`\`\n`;break;case"bold":t+=`**${o.content}**`;break;case"italic":t+=`*${o.content}*`;break;case"heading":t+=`\n${"#".repeat(o.level)} ${o.content}\n\n`}}return t=t.replace(/\n{3,}/g,"\n\n").trim(),t}(o);return console.log("Generated markdown:",r.substring(0,200)+"..."),r}console.log("🚀 Starting Complete Claude Chat Export...");try{const s=function(){const e=['button[data-testid="chat-menu-trigger"] div.truncate',"header div.truncate","div.truncate.tracking-tight","button div.truncate"];for(const t of e){const e=document.querySelector(t);if(e){const t=e.textContent?.trim();if(t&&t.length>0&&!t.match(/^[A-Z]{1,3}$/))return t}}return"Claude Chat Export"}();console.log(`📄 Chat title: ${s}`);const a=function(){const s=[],a=new Set,c=document.querySelectorAll("div"),l=function(){const e=document.querySelectorAll('div[class*="rounded-full"][class*="font-bold"]');for(const t of e){const e=t.textContent?.trim();if(e&&e.match(/^[A-Z]{1,3}$/))return e}return null}();console.log(`📝 Analyzing ${c.length} elements...`),l&&console.log(`👤 Found user initials: ${l}`);for(const i of c){let c=null;if(e(i,["group","relative","inline-flex","bg-bg-300"])||e(i,["group","relative","inline-flex"])&&i.classList.contains("bg-bg-300")){const e=n(i,l);e&&e.length>5&&(c={type:"user",content:e,element:i,contentHash:t(e)},console.log("👤 Found user message:",e.substring(0,50)+"..."))}else if(e(i,["group","relative","-tracking-[0.015em]"])||e(i,["group","relative"])&&i.classList.contains("-tracking-[0.015em]")){const e=i.querySelector('[class*="rounded-lg"][class*="border"]');let n=null;e&&e.querySelector('[class*="overflow"]')&&(n=o(e),console.log("🧠 Found reasoning:",n?.content.substring(0,50)+"..."));const s=r(i,e);(n||s)&&(c={type:"claude",reasoning:n,response:s,element:i,contentHash:t((n?.content||"")+(s||""))},console.log("🤖 Found Claude message"+(n?" (with reasoning)":"")))}c&&!a.has(c.contentHash)&&(a.add(c.contentHash),s.push(c))}return console.log(`✅ Extracted ${s.length} messages total`),0===s.length?(console.warn("⚠️ No messages found"),null):(s.sort((e,t)=>e.element.compareDocumentPosition(t.element)&Node.DOCUMENT_POSITION_FOLLOWING?-1:1),s)}();if(!a||0===a.length)return void alert("❌ No conversation found. Make sure you're on a Claude chat page with messages.");const c=function(e,t){let n=`# ${t}\n\n`;return n+=`*Exported on: ${(new Date).toLocaleString()}*\n\n`,n+=`*Total messages: ${e.length}*\n\n`,n+="---\n\n",e.forEach((t,o)=>{"user"===t.type?n+=`## 👤 User\n\n${t.content}\n\n`:"claude"===t.type&&(n+="## 🤖 Claude\n\n",t.reasoning&&t.reasoning.content&&(n+="<details>\n<summary>🧠 Reasoning",t.reasoning.time&&(n+=` (${t.reasoning.time})`),n+=`</summary>\n\n${t.reasoning.content}\n\n</details>\n\n`),t.response&&(n+=`${t.response}\n\n`)),o<e.length-1&&(n+="---\n\n")}),n}(a,s);console.log("📄 Generated markdown:",c.length,"characters"),console.log("📄 Markdown preview:\n",c.substring(0,500)+"..."),function(e,t){const n=new Blob([e],{type:"text/markdown;charset=utf-8"}),o=URL.createObjectURL(n),s=document.createElement("a");s.href=o;const r=t.replace(/[^a-zA-Z0-9\s\-_]/g,"").replace(/\s+/g,"-").toLowerCase().substring(0,50);s.download=`${r}-${(new Date).toISOString().slice(0,19).replace(/:/g,"-")}.md`,document.body.appendChild(s),s.click(),document.body.removeChild(s),URL.revokeObjectURL(o)}(c,s),console.log("🎉 Export complete!"),alert(`✅ Successfully exported ${a.length} messages!\nCheck your downloads folder.`)}catch(e){console.error("❌ Export error:",e),alert("❌ Export failed. Check the console for details.")}}();
