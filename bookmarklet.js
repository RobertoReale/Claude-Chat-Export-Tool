javascript:!function(){function t(t,e){return e.every(e=>t.classList.contains(e))}function e(t){let e=0;for(let n=0;n<t.length;n++){e=(e<<5)-e+t.charCodeAt(n),e&=e}return e.toString()}function n(t,e=null){let n="";const o=['[data-testid="user-message"]',"div.font-user-message",".prose"];for(const e of o){const o=t.querySelector(e);if(o){const t=o.textContent?.trim()||"";t.length>n.length&&(n=t)}}return n||(n=t.textContent?.trim()||""),function(t,e=null){if(!t)return"";if(e){const n=new RegExp(`^${e}\\s*`,"g");t=t.replace(n,"")}return(t=(t=(t=(t=(t=t.replace(/^[A-Z]{1,3}\s+/,"")).replace(/(Edit|Modifica)\s*\d*\s*\/?\s*\d*/gi,"")).replace(/(?<![a-zA-Z])(Share|Copy|Delete|Condividi|Copia|Elimina)(?![a-zA-Z])/gi,"")).replace(/(?<![a-zA-Z0-9])\d+\s*\/\s*\d+(?![a-zA-Z0-9])/g,"")).replace(/(Edit|Modifica)\s*$/gi,"")).replace(/\s+/g," ").trim()}(n,e)}function o(t){if(!t)return null;let e="",n="";const o=['[class*="tabular-nums"]','[class*="time"]','span:contains("s")','div:contains("s")'];for(const n of o){const o=t.querySelector(n);if(o&&o.textContent.match(/\d+s?/)){e=o.textContent.trim();break}}const s=t.querySelector('[class*="overflow-y-auto"]')||t.querySelector('[class*="overflow"]')||t;return s&&(s.querySelectorAll("p").forEach(t=>{const e=t.textContent.trim();e&&!e.match(/^\d+s?$/)&&(n+=e+"\n\n")}),s.querySelectorAll("ol, ul").forEach(t=>{const e=t.querySelectorAll("li");e.forEach((e,o)=>{const s=e.textContent.trim();s&&("OL"===t.tagName?n+=`${o+1}. ${s}\n`:n+=`- ${s}\n`)}),e.length>0&&(n+="\n")})),n.trim()?{content:n.trim(),time:e}:null}function s(t){const e=t.querySelector('annotation[encoding="application/x-tex"]');return e?e.textContent.trim():null}function r(t,e=null,n={parts:[]},o=0){if(e&&e.contains(t))return n;if(t.classList&&t.classList.contains("katex")){const e=s(t);if(e){const o=t.classList.contains("katex-display")||t.parentElement?.classList.contains("katex-display");n.parts.push({type:"math",content:e,display:o})}return n}if(t.classList&&(t.classList.contains("katex-html")||t.classList.contains("katex-mathml")))return n;const a=t.tagName?.toLowerCase();if("strong"===a||"b"===a){if(function(t){return t.querySelector&&null!==t.querySelector(".katex")}(t)){for(const a of t.children)if(a.classList&&a.classList.contains("katex")){const t=s(a);t&&n.parts.push({type:"bold_math",content:t})}else r(a,e,n,o);for(const e of t.childNodes)if(e.nodeType===Node.TEXT_NODE){const t=e.textContent.trim();t&&n.parts.push({type:"bold",content:t})}return n}n.parts.push({type:"bold",content:t.textContent.trim()})}else if("em"===a||"i"===a)n.parts.push({type:"italic",content:t.textContent.trim()});else{if("br"===a)return n.parts.push({type:"break"}),n;if("p"===a||"div"===a){const s=n.parts[n.parts.length-1];s&&"paragraph"!==s.type&&n.parts.push({type:"paragraph"});for(const s of t.childNodes)if(s.nodeType===Node.TEXT_NODE){const t=s.textContent.trim();if(t){const e=n.parts[n.parts.length-1];e&&"text"===e.type?e.content+=" "+t:n.parts.push({type:"text",content:t})}}else s.nodeType===Node.ELEMENT_NODE&&r(s,e,n,o);return n.parts.push({type:"paragraph"}),n}if("ul"===a||"ol"===a){const s="ol"===a;return Array.from(t.children).filter(t=>"li"===t.tagName.toLowerCase()).forEach((t,a)=>{n.parts.push({type:"listitem",ordered:s,depth:o,index:a+1});for(const s of t.childNodes)if(s.nodeType===Node.TEXT_NODE){const t=s.textContent.trim();t&&n.parts.push({type:"text",content:t})}else s.nodeType===Node.ELEMENT_NODE&&r(s,e,n,o+1);n.parts.push({type:"break"})}),n}if(!("code"!==a||t.parentElement&&"PRE"===t.parentElement.tagName))return n.parts.push({type:"code",content:t.textContent}),n;if("pre"===a){const e=t.querySelector("code");return n.parts.push({type:"codeblock",content:e?e.textContent:t.textContent,language:e?.className?.match(/language-(\w+)/)?.[1]||""}),n}if(a&&a.match(/^h[1-6]$/))return n.parts.push({type:"heading",level:parseInt(a[1]),content:t.textContent}),n;for(const s of t.childNodes)if(s.nodeType===Node.TEXT_NODE){const t=s.textContent.trim();if(t){const e=n.parts[n.parts.length-1];e&&"text"===e.type?e.content+=" "+t:n.parts.push({type:"text",content:t})}}else s.nodeType===Node.ELEMENT_NODE&&r(s,e,n,o)}return n}function a(t,e){console.log("Extracting Claude response...");const n=t.querySelector("div.font-claude-message")||t.querySelector('[class*="prose"]')||t;if(!n)return console.warn("No response area found"),"";const{parts:o}=r(n,e);console.log(`Extracted ${o.length} content parts`);const s=function(t){let e="";for(let n=0;n<t.length;n++){const o=t[n],s=n>0?t[n-1]:null,r=n<t.length-1?t[n+1]:null;switch(s&&("text"===s.type||"bold"===s.type||"italic"===s.type||"code"===s.type)&&("bold"===o.type||"italic"===o.type||"code"===o.type)&&!e.endsWith(" ")&&!e.endsWith("\n")&&(e+=" "),o.type){case"text":e+=o.content;break;case"math":o.display?e+=`\n\n$$${o.content}$$\n\n`:e+=`$${o.content}$`;break;case"bold_math":e+=`**$${o.content}$**`;break;case"listitem":e.endsWith("\n")||(e+="\n");const t="  ".repeat(o.depth);o.ordered?e+=`${t}${o.index}. `:e+=`${t}- `;break;case"paragraph":e.endsWith("\n\n")||(e+="\n\n");break;case"break":e.endsWith("\n")||(e+="\n");break;case"code":e+=`\`${o.content}\``;break;case"codeblock":e+=`\n\`\`\`${o.language}\n${o.content}\n\`\`\`\n`;break;case"bold":e+=`**${o.content}**`;break;case"italic":e+=`*${o.content}*`;break;case"heading":e+=`\n${"#".repeat(o.level)} ${o.content}\n\n`}r&&("bold"===o.type||"italic"===o.type||"code"===o.type)&&"text"===r.type&&!r.content.startsWith(" ")&&!r.content.startsWith(",")&&!r.content.startsWith(".")&&(e+=" ")}return e=e.replace(/\n{3,}/g,"\n\n").trim(),e}(o);return console.log("Generated markdown:",s.substring(0,200)+"..."),s}console.log("🚀 Starting Complete Claude Chat Export...");try{const s=function(){const t=['button[data-testid="chat-menu-trigger"] div.truncate',"header div.truncate","div.truncate.tracking-tight","button div.truncate"];for(const e of t){const t=document.querySelector(e);if(t){const e=t.textContent?.trim();if(e&&e.length>0&&!e.match(/^[A-Z]{1,3}$/))return e}}return"Claude Chat Export"}();console.log(`📄 Chat title: ${s}`);const r=function(){const s=[],r=new Set,c=document.querySelectorAll("div"),l=function(){const t=document.querySelectorAll('div[class*="rounded-full"][class*="font-bold"]');for(const e of t){const t=e.textContent?.trim();if(t&&t.match(/^[A-Z]{1,3}$/))return t}return null}();console.log(`📝 Analyzing ${c.length} elements...`),l&&console.log(`👤 Found user initials: ${l}`);for(const i of c){let c=null;if(t(i,["group","relative","inline-flex","bg-bg-300"])||t(i,["group","relative","inline-flex"])&&i.classList.contains("bg-bg-300")){const t=n(i,l);t&&t.length>0&&(c={type:"user",content:t,element:i,contentHash:e(t)},console.log("👤 Found user message:",t.substring(0,50)+"..."))}else if(t(i,["group","relative","-tracking-[0.015em]"])||t(i,["group","relative"])&&i.classList.contains("-tracking-[0.015em]")){const t=i.querySelector('[class*="rounded-lg"][class*="border"]');let n=null;t&&t.querySelector('[class*="overflow"]')&&(n=o(t),console.log("🧠 Found reasoning:",n?.content.substring(0,50)+"..."));const s=a(i,t);(n||s)&&(c={type:"claude",reasoning:n,response:s,element:i,contentHash:e((n?.content||"")+(s||""))},console.log("🤖 Found Claude message"+(n?" (with reasoning)":"")))}c&&!r.has(c.contentHash)&&(r.add(c.contentHash),s.push(c))}return console.log(`✅ Extracted ${s.length} messages total`),0===s.length?(console.warn("⚠️ No messages found"),null):(s.sort((t,e)=>t.element.compareDocumentPosition(e.element)&Node.DOCUMENT_POSITION_FOLLOWING?-1:1),s)}();if(!r||0===r.length)return void alert("❌ No conversation found. Make sure you're on a Claude chat page with messages.");const c=function(t,e){let n=`# ${e}\n\n`;return n+=`*Exported on: ${(new Date).toLocaleString()}*\n\n`,n+=`*Total messages: ${t.length}*\n\n`,n+="---\n\n",t.forEach((e,o)=>{"user"===e.type?n+=`## 👤 User\n\n${e.content}\n\n`:"claude"===e.type&&(n+="## 🤖 Claude\n\n",e.reasoning&&e.reasoning.content&&(n+="<details>\n<summary>🧠 Reasoning",e.reasoning.time&&(n+=` (${e.reasoning.time})`),n+=`</summary>\n\n${e.reasoning.content}\n\n</details>\n\n`),e.response&&(n+=`${e.response}\n\n`)),o<t.length-1&&(n+="---\n\n")}),n}(r,s);console.log("📄 Generated markdown:",c.length,"characters"),console.log("📄 Markdown preview:\n",c.substring(0,500)+"..."),function(t,e){const n=new Blob([t],{type:"text/markdown;charset=utf-8"}),o=URL.createObjectURL(n),s=document.createElement("a");s.href=o;const r=e.replace(/[^a-zA-Z0-9\s\-_]/g,"").replace(/\s+/g,"-").toLowerCase().substring(0,50);s.download=`${r}-${(new Date).toISOString().slice(0,19).replace(/:/g,"-")}.md`,document.body.appendChild(s),s.click(),document.body.removeChild(s),URL.revokeObjectURL(o)}(c,s),console.log("🎉 Export complete!"),alert(`✅ Successfully exported ${r.length} messages!\nCheck your downloads folder.`)}catch(t){console.error("❌ Export error:",t),alert("❌ Export failed. Check the console for details.")}}();
